<?php

use \Phinx\Migration\AbstractMigration;

class <%= migrationClass %> extends AbstractMigration
{
    public function up()
    {
        $<%= variableName %> = $this->table('<%= table %>', ['primary_key' => '<%= primaryKey %>']);

        <% columns.forEach(c => { %>
        $<%= variableName %>->addColumn('<%= c.name %>', '<%= c.type.name %>'<% if (c.options || c.type.options) { %>, [
            <% for (option in c.options) { %>
            '<%= option %>' => <% if (typeof c.options[option] === 'string' && isNaN(c.options[option])) { %>'<%= c.options[option] %>'<% } else {%><%= c.options[option] %><% } %>,
            <% } %> <% for (option in c.type.options) { %>
            '<%= option %>' => <% if (typeof c.type.options[option] === 'string' && isNaN(c.type.options[option])) { %>'<%= c.type.options[option] %>'<% } else {%><%= c.type.options[option] %><% } %>,
            <% } %>
        ]<% } %>)<% let columnDependencies = dependencies.filter(d => d.sourceColumn === c.name); %><% if (columnDependencies.length === 0) { %>;
            <% } else { %>
                <% columnDependencies
                    .forEach(cd => { %>
            ->addForeignKey(
                '<%= cd.sourceColumn %>', '<%= cd.referencedTable %>', '<%= cd.referencedColumn %>', 
                ['delete' => '<%= cd.deleteRule %>', 'update' => '<%= cd.updateRule %>']
            );
                <% }); %>
            <% } %>
        <% }); %>
        $<%= variableName %>->save();
    }

    public function down()
    {
        $this->dropTable('<%= table %>');
    }
}
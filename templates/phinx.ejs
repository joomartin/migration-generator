<?php

class <%= migrationClass %> extends AbstractMigration
{
    public function up()
    {
        $<%= variableName %> = $this->table('<%= table %>', ['primary_key' => '<%= primaryKey %>']);

        <% columns.forEach(c => { %>
        $<%= variableName %>->addColumn('<%= c.name %>', '<%= c.type.name %>'<% if (c.options || c.type.options) { %>, [
            <% for (option in c.options) { %>
            '<%= option %>' => <%= c.options[option] %>,
            <% } %> <% for (typeOption in c.type.options) { %>
            '<%= typeOption %>' => <%= c.type.options[typeOption] %>,
            <% } %>
        ]<% } %>)<% let columnDependencies = dependencies.filter(d => d.sourceColumn === c.name); %><% if (columnDependencies.length === 0) { %>;
            <% } else { %>
                <% columnDependencies
                    .forEach(cd => { %>
            ->addForeignKey(
                '<%= cd.sourceColumn %>', '<%= cd.referencedTable %>', '<%= cd.referencedColumn %>', 
                ['delete' => '<%= cd.deleteRule %>', 'update' => '<%= cd.updateRule %>']
            );
                <% }); %>
            <% } %>
        <% }); %>
        $<%= variableName %>->save();
    }

    public function down()
    {
        $this->dropTable('<%= table %>');
    }
}